---
import { getCollection } from "astro:content";
import { availableLanguages } from "@/config/i18n/messages";
import {
    getBlogNameFromLang,
    getLangFromUrl,
    useTranslations,
} from "@/config/i18n/utils";
import { SITE_DESCRIPTION, SITE_TITLE } from "@/consts";
import PostCard from "@/presentation/components/cross/PostCard.astro";
import BaseHead from "@/presentation/components/nav/BaseHead.astro";
import Body from "@/presentation/layouts/Body.astro";

export const prerender = true;

export async function getStaticPaths() {
    return availableLanguages.map((lang) => ({ params: { lang } }));
}

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang, "blog");
const blogName = getBlogNameFromLang(lang);
const posts = (await getCollection(blogName)).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang={lang}>
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<Body class="flex flex-col flex-1 w-full">
		<section class="w-full max-w-6xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
			<h1 class="text-2xl sm:text-3xl font-bold text-gray-800 dark:text-gray-200 mb-6 sm:mb-8">
				{t("title")}
			</h1>
			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
				{
					posts.map((post) => (
						<div class="w-full min-h-[420px] flex">
							<PostCard post={post} showDescription />
						</div>
					))
				}
			</div>
		</section>
	</Body>
</html>
