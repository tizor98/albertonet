---
import { getLangFromUrl, useTranslations } from "@/config/i18n/utils";
import { paths } from "@/config/paths";
import ThemeSwitcher from "@/presentation/components/cross/ThemeSwitcher.astro";
import LanguageSwitcher from "../cross/LanguageSwitcher.astro";
import Link from "../ui/Link.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang, "home");
---

<div class="lg:hidden flex items-center gap-0.5 md:gap-1">
    <button
        type="button"
        id="navbar-mobile-toggle"
        class="ui-control"
        aria-controls="navbar-mobile"
        aria-expanded="false"
    >
        <span id="open" class="icon-[mdi--hamburger-menu] w-4 h-4 transition-all ease-in-out"  />
        <span id="close" class="hidden icon-[mdi--cross-circle-outline] w-4 h-4 ease-in-out transition-all text-inherit" />
    </button>
    <LanguageSwitcher />
    <ThemeSwitcher />
    <button id="navbar-mobile-backdrop" type="button" class="hidden fixed inset-0 z-40 bg-black/40" aria-hidden="true"></button>
    <div
        id="navbar-mobile"
        class="hidden fixed z-50 top-20 left-4 right-4 p-6 flex-col items-start justify-start gap-4 text-xl ui-card"
        role="dialog"
        aria-modal="true"
        aria-label="Mobile navigation"
    >
        <Link
            href={paths.blog(lang)}
        >
            <div class="adaptive-text z-50 duration-150">{t("blogLink")}</div>
        </Link>
        <Link
            href={paths.contact(lang)}
        >
            <div class="adaptive-text z-50 duration-150">{t("contactLink")}</div>
        </Link>
    </div>
</div>

<script is:inline>
const panel = document.getElementById("navbar-mobile");
const toggle = document.getElementById("navbar-mobile-toggle");
const backdrop = document.getElementById("navbar-mobile-backdrop");

function openNav() {
    panel?.classList.remove("hidden");
    panel?.classList.add("flex");
    backdrop?.classList.remove("hidden");
    document.getElementById("open")?.classList.add("hidden");
    document.getElementById("close")?.classList.remove("hidden");
    toggle?.setAttribute("aria-expanded", "true");
}

function closeNav() {
    panel?.classList.add("hidden");
    panel?.classList.remove("flex");
    backdrop?.classList.add("hidden");
    document.getElementById("open")?.classList.remove("hidden");
    document.getElementById("close")?.classList.add("hidden");
    toggle?.setAttribute("aria-expanded", "false");
}

function toggleNav() {
    if (panel?.classList.contains("hidden")) {
        openNav();
        return;
    }

    closeNav();
}

toggle?.addEventListener("click", toggleNav);
backdrop?.addEventListener("click", closeNav);
panel?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", closeNav);
});

document.addEventListener("keydown", (event) => {
    if (event.key === "Escape") {
        closeNav();
    }
});
</script>
