---
import { getLangFromUrl, useTranslations } from "@/config/i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang, "home");
---

<div class="dropdown dropdown-hover dropdown-end">
  <button type="button" class="ui-control" aria-label="Theme switcher">
    <span class="icon-[mdi--white-balance-sunny] w-4 h-4 rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"></span>
    <span class="absolute icon-[mdi--moon-and-stars] w-4 h-4 rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"></span>
  </button>
  <ul class="menu dropdown-content ui-dropdown-panel z-1 w-36 p-2 shadow-none">
      <li><button onclick="setTheme('light')" id="light">{t("lightTheme")}</button></li>
      <li><button onclick="setTheme('dark')" id="dark">{t("darkTheme")}</button></li>
      <li><button onclick="setTheme('system')" id="system">{t("systemTheme")}</button></li>
  </ul>
</div>

<script is:inline>

function setTheme(theme) {
  if (theme === 'system') {
    localStorage.removeItem("theme");
    if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  } else {
    localStorage.setItem("theme", theme);
  }

  if (theme === 'light') {
    document.documentElement.classList.remove("dark");
  } else if (theme === 'dark') {
    document.documentElement.classList.add("dark");
  }
}
</script>
